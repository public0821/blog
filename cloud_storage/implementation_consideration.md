### 实现云存储软件时需要考虑的一些问题

#### 数据存多少份比较合适

目前普遍的采用存储3份,但这样造成存储利用率低，有些软件提供Erasure Code功能，只要存储1.x份就可以达到相同级别的数据持久性，但缺点是性能慢，代码实现复杂。

#### 根据文件名称或者ID怎么定位到文件存储位置

Hash Ring或者直接用一个分布式的K/V系统管理元数据

#### 操作的过程中出现错误怎么处理

比如上传，更新或者删除的过程中，由于网络问题，上传文件时写成功了两份，有一份失败，是返回客户失败还是成功呢，如果返回成功，剩下的那份没成功的咋办？如果返回失败，已经上传的那两份咋办？

#### 如何保证数据均匀分布，避免某些node的压力过大

比如一个node的磁盘快满了，而刚刚新加的node的盘才用了10%，如果数据访问是平均的，那盘满的node就会压力大。
    
#### 如何扩容动态扩容，扩容的过程中不影响使用

Hash Ring一般采取的方法是逐步的加入新硬件，边加边移动数据

#### 磁盘坏了如何能及时发现，如何更换一块新盘

坏一块硬盘就跑去换一块，成本较高，如何做到坏了很多块之后才需要去统一换一下。 比如坏了2块硬盘后，系统能检测到这两块硬盘上没有存储相同的文件，所以至少还有2份拷贝，相对来说还很安全。

#### 如何发现磁盘里面有坏道，检测出来后如何处理

定时扫描所有的文件，判断最后访问时间，如果最后访问时间太久（可设置），就试着读取该文件,如果读取失败，立即恢复该文件。

#### node挂掉后如何处理

比如node的硬件坏了，需要更换硬件，但更换硬件会需要几天，这段时间设备上的数据怎么处理？如果当成这个node的磁盘都坏了，进行恢复，一般一个node至少挂十几块硬盘，将这部分数据恢复到系统的其它地方，也要花很长的时间
   
#### 如何升级硬件
    
比如几年前用的都是1T的硬盘，单位存储密度较低，现在想做下升级，升级到5T的硬盘，同时将node的cpu和内存也做下升级
    
#### 如何升级软件
    
软件在不停的开发，改了很多bug，加入和很多新的功能，如何在不影响现有业务的情况下进行升级呢？
    


